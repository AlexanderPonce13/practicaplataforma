<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ================= META CONFIG ================= -->
    <meta charset="UTF-8">
    <!-- Controla el escalado en m√≥viles -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>URDANIGO | Tech Store</title>
    
    <h2>Manuel Ponce</h2>
    <!-- ================= FUENTES ================= -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">

    <!-- ================= ICONOS ================= -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- ================= PAYPHONE SDK ================= -->
    <script src="https://cdn.payphonetodoesposible.com/box/v1.1/payphone-payment-box.js" type="module"></script>
    <link href="https://cdn.payphonetodoesposible.com/box/v1.1/payphone-payment-box.css" rel="stylesheet">

    <!-- ================= ESTILOS ================= -->
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #2563eb;
            --background: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
            --success: #10b981;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background: var(--background);
            color: var(--text);
        }

        header {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 20px;
            text-align: center;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #334155;
        }

        .brand {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 1.8rem;
        }

        .brand span {
            color: var(--primary);
        }

        .container {
            max-width: 1100px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .product-card {
            background: var(--card);
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-6px);
            border-color: var(--primary);
            box-shadow: 0 15px 35px rgba(0, 242, 255, 0.2);
        }

        .icon-box {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .price {
            font-size: 1.6rem;
            font-weight: bold;
            margin-top: 10px;
        }

        .tax {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 20px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            color: #fff;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ================= MODAL ================= */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(6px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* üî• CAMBIO CLAVE AQU√ç üî• */
        .modal-box {
            background: #fff;
            color: #333;
            padding: 30px;
            border-radius: 18px;
            width: 400px;
            max-width: 90%;
            height: 90vh;              /* ‚Üê evita que se salga */
            overflow-y: auto;          /* ‚Üê scroll interno */
            position: relative;
            text-align: center;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
            font-size: 22px;
        }

        #success-view {
            display: none;
            text-align: center;
        }

        .receipt-card {
            background: #fff;
            color: #333;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .check-icon {
            font-size: 4rem;
            color: var(--success);
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }

        .total-row {
            margin-top: 15px;
            font-weight: 800;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
    </style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header>
    <div class="brand">
        <i class="fas fa-microchip"></i> URDANI<span>GO</span>
    </div>
</header>

<div class="container">

    <!-- ================= VISTA TIENDA ================= -->
    <section id="shop-view">
        <h2 style="text-align:center;margin-bottom:30px;">Selecciona tu Hardware</h2>
        <div class="grid" id="productGrid"></div>
    </section>

    <!-- ================= VISTA SUCCESS ================= -->
    <section id="success-view">
        <div class="receipt-card">
            <i class="fas fa-check-circle check-icon"></i>
            <h2>Pago Exitoso</h2>

            <div class="receipt-row"><strong>Producto:</strong><span id="rec-product"></span></div>
            <div class="receipt-row"><strong>ID:</strong><span id="rec-id"></span></div>
            <div class="receipt-row"><strong>Autorizaci√≥n:</strong><span id="rec-auth"></span></div>
            <div class="receipt-row"><strong>Tarjeta:</strong><span id="rec-card"></span></div>
            <div class="receipt-row total-row"><strong>Total:</strong><span id="rec-total"></span></div>

            <button class="btn" onclick="location.reload()">Nueva Compra</button>
        </div>
    </section>

</div>

<!-- ================= MODAL PAGO ================= -->
<div class="modal-overlay" id="paymentModal">
    <div class="modal-box">
        <span class="close-modal" onclick="closeModal()">√ó</span>
        <h3>Pasarela de Pago</h3>
        <p>Total: <strong id="modal-amount"></strong></p>
        <div id="pp-button"></div>
    </div>
</div>

<script>
/* =====================================================
   CONFIGURACI√ìN GENERAL
===================================================== */
const CONFIG = {
    token: "nTO-5_gf1DjcOPxOPP7dywgANG41owuWumdUC_v-5gak2CwYwLyNLwRjbCzHGXZVmC2CKZytExvw7PjUTzQZ0lkFRCwXfFtbW1wbJRfS4WKw3fxKhQeH1KdVqrzvxoui1qT8cWFkw_jaXYQen38I-VSAxmcUJydW-Q0GS592DuMpcUK71q9ADQEZ5wssLX3fWIRjiWgOJiMYmHxyjk2bJEwedfoiyHXc5ErAaIOWMLtKhsOrdHp7UsB3jt7jAZ9HMTVrVSf9KoCsdey2eKfZ_HVRQRqii5Opemw4SY5X2cRta9VGYRp-oBMQzEXl5QzBduyGlw",
    storeId: "30fc4eb4-3aae-4f9a-b70a-4d2b3995907d"
};

/* =====================================================
   PRODUCTOS (PRECIOS EST√ÅTICOS EN CENTAVOS)
===================================================== */
const products = [
    { id: 1, name: "Mouse Gamer RGB", icon: "fa-mouse", base: 1200, tax: 180 },
    { id: 2, name: "Teclado Mec√°nico Pro", icon: "fa-keyboard", base: 6500, tax: 975 },
    { id: 3, name: "Headset 7.1 Surround", icon: "fa-headset", base: 3500, tax: 525 },
    { id: 4, name: "Webcam Full HD", icon: "fa-video", base: 4200, tax: 630 },
    { id: 5, name: "SSD NVMe 1TB", icon: "fa-hard-drive", base: 9500, tax: 1425 },
    { id: 6, name: "Monitor Gamer 144Hz", icon: "fa-desktop", base: 18500, tax: 2775 }
];

// Producto seleccionado actualmente
let currentProduct = null;

// Contenedor donde se renderizan los productos
const grid = document.getElementById("productGrid");

/* =====================================================
   RENDER DE PRODUCTOS
===================================================== */
products.forEach(product => {
    const card = document.createElement("div");
    card.className = "product-card";

    // HTML interno de cada tarjeta
    card.innerHTML = `
        <div class="icon-box"><i class="fas ${product.icon}"></i></div>
        <h3>${product.name}</h3>
        <div class="price">$${((product.base + product.tax) / 100).toFixed(2)}</div>
        <div class="tax">Incluye IVA</div>
        <button class="btn">Comprar</button>
    `;

    // Evento de compra
    card.querySelector("button").onclick = () => startPurchase(product);

    grid.appendChild(card);
});

/* =====================================================
   INICIAR COMPRA
===================================================== */
function startPurchase(product) {
    currentProduct = product;

    // Total en centavos
    const total = product.base + product.tax;

    // Mostrar monto en el modal
    document.getElementById("modal-amount").textContent = `$${(total / 100).toFixed(2)}`;

    // Mostrar modal
    document.getElementById("paymentModal").style.display = "flex";

    // Renderizar bot√≥n Payphone
    renderPayphone(product, total);
}

/* =====================================================
   PAYPHONE
===================================================== */
function renderPayphone(product, total) {
    document.getElementById("pp-button").innerHTML = "";

    const paymentBox = new PPaymentButtonBox({
        token: CONFIG.token,
        storeId: CONFIG.storeId,
        clientTransactionId: "URD-" + Date.now(),
        amount: total,
        amountWithTax: product.base,
        tax: product.tax,
        currency: "USD",
        reference: product.name,
        onTransactionApproved: showSuccess,
        onTransactionError: () => alert("Error en el pago")
    });

    paymentBox.render("pp-button");
}

/* =====================================================
   MOSTRAR CONFIRMACI√ìN
===================================================== */
function showSuccess(data) {
    closeModal();

    document.getElementById("shop-view").style.display = "none";
    document.getElementById("success-view").style.display = "block";

    document.getElementById("rec-product").textContent = currentProduct.name;
    document.getElementById("rec-id").textContent = data.transactionId;
    document.getElementById("rec-auth").textContent = data.authorizationCode;
    document.getElementById("rec-card").textContent = `${data.cardBrand} ****${data.lastDigits}`;
    document.getElementById("rec-total").textContent = `$${(data.amount / 100).toFixed(2)}`;
}

/* =====================================================
   CERRAR MODAL
===================================================== */
function closeModal() {
    document.getElementById("paymentModal").style.display = "none";
    document.getElementById("pp-button").innerHTML = "";
}
</script>

</body>
</html>
